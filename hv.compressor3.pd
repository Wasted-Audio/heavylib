#N canvas 595 23 526 691 10;
#X obj 315 56 inlet;
#X obj 28 52 inlet~ input;
#X obj 28 643 outlet~;
#X obj 43 179 r \$0-threshold;
#X obj 256 617 hv.dispatch \$0 knee 10;
#X obj 315 106 hv.dispatch \$0 threshold -20;
#X obj 315 86 hv.dispatch \$0 ratio 5;
#X obj 43 201 clip -100 0;
#X obj 43 247 line~;
#X obj 75 446 line~;
#X obj 315 126 hv.dispatch \$0 rms 1;
#X obj 205 124 r \$0-rms;
#N canvas 0 22 296 300 rms/peak 1;
#X obj 117 86 env~ 256;
#X obj 117 132 sig~;
#X msg 193 86 \$1 10;
#X obj 193 108 line~;
#X obj 26 25 inlet~;
#X obj 26 260 outlet~;
#X obj 193 28 inlet;
#X obj 117 188 -~;
#X obj 117 214 *~;
#X text 93 260 linear xfade \, y = a + x(b - a);
#X obj 117 108 - 100;
#X obj 26 80 abs~;
#X obj 26 132 rmstodb~;
#X obj 26 154 -~ 100;
#X connect 0 0 10 0;
#X connect 1 0 7 0;
#X connect 2 0 3 0;
#X connect 3 0 8 1;
#X connect 4 0 0 0;
#X connect 4 0 11 0;
#X connect 6 0 2 0;
#X connect 7 0 8 0;
#X connect 8 0 5 0;
#X connect 10 0 1 0;
#X connect 11 0 12 0;
#X connect 12 0 13 0;
#X connect 13 0 5 0;
#X connect 13 0 7 1;
#X restore 142 160 pd rms/peak;
#X text 192 467 slope = 1 - (1 / ratio);
#X obj 43 390 -~;
#X obj 43 467 *~;
#N canvas 0 22 510 686 envfollow 0;
#X obj 38 464 -~;
#X obj 38 424 sig~ 1;
#X obj 23 524 rpole~;
#X obj 163 83 loadbang;
#X obj 163 110 samplerate~;
#X obj 97 193 *;
#X obj 97 237 /;
#X obj 23 494 *~;
#X obj 97 26 inlet attack;
#X obj 23 644 outlet~;
#X obj 97 423 *~;
#X obj 251 192 *;
#X obj 251 25 inlet release;
#X obj 236 425 *~;
#X obj 112 355 hv.gt;
#X obj 157 355 sig~ 1;
#X obj 157 390 -~;
#X obj 97 160 max 0.1;
#X obj 251 160 max 0.1;
#X text 185 568 temp = abs(in);
#X text 185 628 else;
#X text 185 588 if (tmp > env);
#X obj 139 328 r~ \$0-env;
#X obj 77 644 s~ \$0-env;
#X msg 251 214 -1 \$1;
#X obj 251 271 exp;
#X msg 251 293 \$1 10;
#X obj 251 315 line~;
#X obj 251 236 /;
#X obj 97 269 exp;
#X msg 97 291 \$1 10;
#X obj 97 313 line~;
#X text 195 608 env = temp + attack_coeff * (env - temp);
#X text 185 538 release_coeff = exp(-1 / (Fs * release_time));
#X text 185 518 attack_coeff = exp(-1 / (Fs * release_time));
#X text 195 648 env = temp + release_coeff * (env - temp);
#X obj 97 132 / 1000;
#X obj 251 132 / 1000;
#X msg 97 215 -1 \$1;
#X text 183 486 http://www.musicdsp.org/archive.php?classid=2#97;
#X obj 23 315 inlet~;
#X connect 0 0 7 1;
#X connect 1 0 0 0;
#X connect 2 0 9 0;
#X connect 2 0 23 0;
#X connect 3 0 4 0;
#X connect 4 0 5 1;
#X connect 4 0 11 1;
#X connect 5 0 38 0;
#X connect 6 0 29 0;
#X connect 7 0 2 0;
#X connect 8 0 36 0;
#X connect 10 0 0 1;
#X connect 10 0 2 1;
#X connect 11 0 24 0;
#X connect 12 0 37 0;
#X connect 13 0 2 1;
#X connect 13 0 0 1;
#X connect 14 0 10 1;
#X connect 14 0 16 1;
#X connect 15 0 16 0;
#X connect 16 0 13 0;
#X connect 17 0 5 0;
#X connect 18 0 11 0;
#X connect 22 0 14 1;
#X connect 24 0 28 0;
#X connect 25 0 26 0;
#X connect 26 0 27 0;
#X connect 27 0 13 1;
#X connect 28 0 25 0;
#X connect 29 0 30 0;
#X connect 30 0 31 0;
#X connect 31 0 10 0;
#X connect 36 0 17 0;
#X connect 37 0 18 0;
#X connect 38 0 6 0;
#X connect 40 0 7 0;
#X connect 40 0 14 0;
#X restore 142 265 pd envfollow;
#X obj 43 505 min~ 0;
#X obj 28 598 *~;
#X obj 43 560 dbtorms~;
#X obj 43 527 +~ 100;
#X obj 315 246 r \$0-ratio;
#X msg 315 289 1 \$1;
#X obj 315 311 /;
#X obj 315 268 max 1;
#X msg 315 333 1 \$1;
#X obj 315 355 -;
#X obj 315 377 s \$0-slope;
#X obj 75 397 r \$0-slope;
#X obj 176 198 r \$0-attack;
#X obj 211 229 r \$0-release;
#X obj 315 146 hv.dispatch \$0 attack 0;
#X obj 315 166 hv.dispatch \$0 release 0;
#X text 192 487 gain_dB = slope * (threshold_dB - env_dB);
#X text 192 507 out = in * toAmp(min(gain_dB \, 0));
#X obj 43 223 pack f 10;
#X obj 75 424 pack f 10;
#X text 246 589 TODO:;
#X connect 0 0 6 0;
#X connect 1 0 12 0;
#X connect 1 0 18 0;
#X connect 3 0 7 0;
#X connect 5 0 10 0;
#X connect 6 0 5 0;
#X connect 7 0 35 0;
#X connect 8 0 14 0;
#X connect 9 0 15 1;
#X connect 10 0 31 0;
#X connect 11 0 12 1;
#X connect 12 0 16 0;
#X connect 14 0 15 0;
#X connect 15 0 17 0;
#X connect 16 0 14 1;
#X connect 17 0 20 0;
#X connect 18 0 2 0;
#X connect 19 0 18 1;
#X connect 20 0 19 0;
#X connect 21 0 24 0;
#X connect 22 0 23 0;
#X connect 23 0 25 0;
#X connect 24 0 22 0;
#X connect 25 0 26 0;
#X connect 26 0 27 0;
#X connect 28 0 36 0;
#X connect 29 0 16 1;
#X connect 30 0 16 2;
#X connect 31 0 32 0;
#X connect 35 0 8 0;
#X connect 36 0 9 0;
